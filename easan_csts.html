<!doctype html>
<html lang=en>
<head>
<meta charset=UTF-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Your Orders</title>
<link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css rel=stylesheet>
<link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css rel=stylesheet>
<link href=https://unpkg.com/aos@2.3.1/dist/aos.css rel=stylesheet>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" rel=stylesheet>
<style>:root{--primary-color:#2a7f62;--primary-light:#3a9d7a;--primary-dark:#1f6b4e;--secondary-color:#f8f9fa;--accent-color:#ff6b35;--success-color:#28a745;--danger-color:#dc3545;--warning-color:#ffc107;--info-color:#17a2b8;--text-dark:#212529;--text-light:#6c757d;--text-lighter:#adb5bd;--border-color:#dee2e6;--shadow-sm:0 1px 3px rgba(0, 0, 0, 0.08);--shadow-md:0 4px 12px rgba(0, 0, 0, 0.1);--shadow-lg:0 8px 24px rgba(0, 0, 0, 0.12);--transition:all 0.3s ease;--border-radius:8px;--border-radius-lg:12px}body{font-family:Outfit,sans-serif;background-color:var(--secondary-color);color:var(--text-dark);line-height:1.6}.container{max-width:1200px}h1{font-weight:700;color:var(--primary-dark);margin-bottom:1.5rem;position:relative;display:inline-block}h1:after{content:'';position:absolute;bottom:-8px;left:50%;transform:translateX(-50%);width:80px;height:4px;background-color:var(--accent-color);border-radius:2px}.header-section{text-align:center;margin-bottom:2rem}.header-section .subtitle{color:var(--text-light);font-size:.9rem}.filter-buttons{display:flex;justify-content:center;gap:12px;margin-bottom:2rem;flex-wrap:wrap}.filter-btn{padding:8px 20px;border:1px solid var(--border-color);border-radius:50px;background-color:#fff;color:var(--text-dark);font-weight:500;cursor:pointer;transition:var(--transition);box-shadow:var(--shadow-sm);font-size:.85rem}.filter-btn:hover{background-color:#f1f3f5;transform:translateY(-2px);box-shadow:var(--shadow-md)}.filter-btn.active{background-color:var(--primary-color);color:#fff;border-color:var(--primary-color);box-shadow:0 4px 12px rgba(42,127,98,.2)}.filter-btn.active:hover{background-color:var(--primary-dark)}.table-container{background:#fff;border-radius:var(--border-radius-lg);box-shadow:var(--shadow-md);overflow:hidden;border:1px solid var(--border-color)}.table{margin-bottom:0}.table thead th{background-color:#f8f9fa;border-bottom-width:1px;font-weight:600;color:var(--text-dark);text-transform:uppercase;font-size:.8rem;letter-spacing:.5px;padding:12px 16px}.table tbody td{padding:16px;vertical-align:middle;border-top:1px solid var(--border-color)}.table tbody tr:last-child td{border-bottom:none}.table tbody tr:hover{background-color:rgba(42,127,98,.03)}.status-badge{padding:6px 12px;border-radius:50px;font-size:.75rem;font-weight:600;text-transform:capitalize;display:inline-block;letter-spacing:.3px}.status-badge.processing{background-color:rgba(23,162,184,.1);color:var(--info-color)}.status-badge.packed,.status-badge.shipped{background-color:rgba(255,193,7,.1);color:var(--warning-color)}.status-badge.delivered{background-color:rgba(40,167,69,.1);color:var(--success-color)}.status-badge.cancelled{background-color:rgba(220,53,69,.1);color:var(--danger-color)}.status-info{font-size:.75rem;color:var(--text-light);margin-top:4px}.payment-badge{padding:6px 12px;border-radius:50px;font-size:.75rem;font-weight:600;display:inline-block}.payment-badge.paid{background-color:rgba(40,167,69,.1);color:var(--success-color)}.payment-badge.not-paid{background-color:rgba(220,53,69,.1);color:var(--danger-color)}.payment-badge.cod{background-color:rgba(255,193,7,.1);color:var(--warning-color)}.order-id{font-weight:600;color:var(--primary-dark);font-family:Outfit,sans-serif}.order-total{font-weight:600;color:var(--success-color)}.view-link{color:var(--primary-color);font-weight:500;text-decoration:none;transition:var(--transition)}.view-link:hover{color:var(--primary-dark);text-decoration:underline}.btn-outline-primary{color:var(--primary-color);border-color:var(--primary-color)}.btn-outline-primary:hover{background-color:var(--primary-color);color:#fff}.load-more-btn{background-color:var(--primary-color);border:none;padding:10px 24px;font-weight:500;letter-spacing:.5px;transition:var(--transition);box-shadow:var(--shadow-sm)}.load-more-btn:hover{background-color:var(--primary-dark);transform:translateY(-2px);box-shadow:var(--shadow-md)}.load-more-btn:disabled{background-color:#e9ecef;color:var(--text-light)}.no-orders{background:#fff;border-radius:var(--border-radius-lg);padding:3rem 2rem;text-align:center;box-shadow:var(--shadow-sm);border:1px dashed var(--border-color)}.no-orders .icon{font-size:3rem;color:var(--text-lighter);margin-bottom:1.5rem}.no-orders h4{color:var(--text-dark);margin-bottom:.5rem}.no-orders p{color:var(--text-light);max-width:400px;margin:0 auto 1.5rem}.modal-content{border:none;border-radius:var(--border-radius-lg);overflow:hidden;box-shadow:var(--shadow-lg)}.modal-header{background-color:var(--secondary-color);border-bottom:1px solid var(--border-color);padding:1.25rem 1.5rem}.modal-title{font-weight:600;color:var(--primary-dark)}.modal-body{padding:1.5rem}.modal-footer{background-color:var(--secondary-color);border-top:1px solid var(--border-color)}.order-details-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid var(--border-color)}.order-status-container{text-align:right}.order-detail-item{padding:12px 0;border-bottom:1px solid var(--border-color)}.order-detail-item:last-child{border-bottom:none}.customer-support-section{background-color:var(--secondary-color);border-radius:var(--border-radius);padding:1.25rem;margin-top:1.5rem;border:1px solid var(--border-color)}.customer-support-section h6{color:var(--primary-dark);margin-bottom:1rem}.support-contact{display:flex;align-items:center;margin-bottom:.75rem}.support-contact i{color:var(--primary-color);margin-right:.75rem;font-size:1.1rem}.order-note{background-color:#fff8e1;padding:.75rem 1rem;border-radius:var(--border-radius);margin-top:1rem;font-size:.85rem;border-left:3px solid var(--warning-color)}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.fade-in{animation:fadeIn .4s ease-out forwards}@media (max-width:768px){.container{padding-left:15px;padding-right:15px}.header-section{margin-bottom:1.5rem}h1{font-size:1.8rem;margin-bottom:1rem}.filter-buttons{gap:6px;margin-bottom:1.5rem;justify-content:flex-start;overflow-x:auto;padding-bottom:8px;-webkit-overflow-scrolling:touch;white-space:nowrap;flex-wrap:nowrap}.filter-btn{padding:8px 14px;font-size:.78rem;white-space:nowrap;flex-shrink:0}.table thead{display:none}.table tbody tr{display:block;margin-bottom:1.25rem;border-radius:var(--border-radius);box-shadow:var(--shadow-sm);overflow:hidden;background:#fff;border:1px solid var(--border-color)}.table tbody td{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border:none;border-bottom:1px solid var(--border-color)}.table tbody td:before{content:attr(data-label);font-weight:600;color:var(--text-dark);margin-right:1rem;flex:1;font-size:.85rem}.table tbody td .payment-badge,.table tbody td .status-badge{padding:6px 10px;font-size:.7rem}.table tbody td .status-info{display:none}.table tbody td:last-child{border-bottom:none;justify-content:center;padding-top:10px;padding-bottom:10px}.view-details-btn{width:100%;padding:8px 12px;font-size:.85rem}.modal-dialog{margin:.5rem}.modal-content{border-radius:var(--border-radius)}.modal-body{padding:1rem}.order-details-header{flex-direction:column;gap:1rem}.order-status-container{text-align:left;width:100%}.payment-section .row>div{width:100%;margin-bottom:.75rem}.customer-support-section{padding:1rem}.order-actions{flex-direction:column;gap:.75rem}.order-actions a{width:100%;justify-content:center;padding:10px}.no-orders{padding:2rem 1rem}.no-orders .icon{font-size:2.5rem}.no-orders h4{font-size:1.2rem}.no-orders p{font-size:.9rem}.table tbody td:first-child:before{content:"Order ID"}.table tbody td:nth-child(2):before{content:"Items"}.table tbody td:nth-child(3):before{content:"Total"}.table tbody td:nth-child(4):before{content:"Status"}.table tbody td:nth-child(5):before{content:"Payment"}.table tbody td:nth-child(6):before{content:"Order Date"}}@media (max-width:480px){h1{font-size:1.5rem}.header-section .subtitle{font-size:.8rem}.filter-btn{padding:6px 12px;font-size:.72rem}.table tbody td{padding:12px 14px}.no-orders{padding:1.5rem 1rem}.no-orders .btn{width:100%}.load-more-btn{width:100%;padding:12px}}</style>
</head>
<body>
<div class="container py-4">
<div class=header-section data-aos=fade-down>
<h1>Your Order History</h1>
<p class=subtitle data-aos=fade-up data-aos-delay=100>Latest orders appear at the top</p>
</div>
<div class=filter-buttons id=filter-buttons data-aos=fade-up data-aos-delay=150>
<button class="filter-btn active" data-filter=recent>Recent Orders</button>
<button class=filter-btn data-filter=all>All Orders</button>
<button class=filter-btn data-filter=processing>Processing</button>
<button class=filter-btn data-filter=packed>Packed</button>
<button class=filter-btn data-filter=delivered>Delivered</button>
<button class=filter-btn data-filter=cancelled>Cancelled</button>
</div>
<div id=loading-spinner class="text-center my-5 py-5">
<div class="spinner-border text-primary" role=status style=width:3rem;height:3rem>
<span class=visually-hidden>Loading...</span>
</div>
<p class="mt-3 text-muted">Loading your order history...</p>
</div>
<div id=order-summary style=display:none>
<div class="table-responsive fade-in">
<div class=table-container>
<table class="table table-hover">
<thead>
<tr>
<th>Order ID</th>
<th>Items</th>
<th>Total</th>
<th>Status</th>
<th>Payment</th>
<th>Order Date</th>
<th>Actions</th>
</tr>
</thead>
<tbody id=order-table-body></tbody>
</table>
</div>
</div>
<button id=load-more-btn class="btn btn-primary load-more-btn mt-4 mx-auto d-block" style=display:none>
<i class="fas fa-plus-circle me-2"></i>Load More Orders
</button>
</div>
<div id=no-orders class=no-orders style=display:none>
<i class="fas fa-box-open icon"></i>
<h4>No Orders Found</h4>
<p>You haven't placed any orders yet. Start shopping to see your order history here.</p>
</div>
</div>
<div class="modal fade" id=orderModal tabindex=-1 aria-labelledby=orderModalLabel aria-hidden=true>
<div class="modal-dialog modal-dialog-scrollable modal-lg">
<div class=modal-content>
<div class=modal-header>
<h5 class=modal-title id=orderModalLabel>Order Details</h5>
<button type=button class=btn-close data-bs-dismiss=modal aria-label=Close></button>
</div>
<div class=modal-body id=modal-content>
</div>
<div class=modal-footer>
<button type=button class="btn btn-secondary" data-bs-dismiss=modal>Close</button>
</div>
</div>
</div>
</div>
<div class="position-fixed bottom-0 end-0 p-3" style=z-index:11>
<div id=packed-notification class="toast hide" role=alert aria-live=assertive aria-atomic=true>
<div class=toast-header style=background-color:var(--primary-color);color:#fff>
<strong class=me-auto>Order Update</strong>
<button type=button class="btn-close btn-close-white" data-bs-dismiss=toast aria-label=Close></button>
</div>
<div class=toast-body>
<i class="fas fa-envelope me-2"></i>You'll receive an email confirmation for your packed order!
</div>
</div>
</div>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js></script>
<script src=https://unpkg.com/aos@2.3.1/dist/aos.js></script>
<script>AOS.init({duration:600,easing:"ease-out-quad",once:!0});const customerId=localStorage.getItem("customer_id");customerId||window.location.replace("https://easanmart.netlify.app/easan_login");let allOrders=[],batchSize=10,offset=0,modalInstance=null,currentFilter="recent";function fetchOrders(){document.getElementById("loading-spinner").style.display="block",document.getElementById("order-summary").style.display="none",document.getElementById("no-orders").style.display="none",fetch(`https://script.google.com/macros/s/AKfycbw-OMfPU8s7w9R6rH7ENDF44npaigpvc-m5R2nl8PHlK43gVo2uYVOxDF5qYxiSSUfDzw/exec?action=getOrdersByCustomerId&customer_id=${customerId}&limit=${batchSize}&offset=${offset}`).then((e=>e.json())).then((e=>{if(document.getElementById("loading-spinner").style.display="none",!e||0===e.length)return 0===offset&&(document.getElementById("no-orders").style.display="block"),document.getElementById("load-more-btn").disabled=!0,void(document.getElementById("load-more-btn").textContent="No More Orders");const t=e.map((e=>(e.payment_status||(e.payment_status="Not Paid"),e))).reverse();allOrders=[...allOrders,...t],applyFilter(currentFilter),checkPackedOrders(t),offset+=batchSize,document.getElementById("load-more-btn").disabled=e.length<batchSize,document.getElementById("load-more-btn").style.display="block"})).catch((e=>{document.getElementById("loading-spinner").style.display="none",document.getElementById("order-summary").innerHTML=`\n          <div class="alert alert-danger text-center">\n            <i class="fas fa-exclamation-triangle me-2"></i>\n            Error loading orders: ${e.message}. Please try again later.\n          </div>\n        `,document.getElementById("order-summary").style.display="block"}))}function applyFilter(e){currentFilter=e;let t=[];switch(e){case"recent":default:t=allOrders.slice(0,3);break;case"all":t=allOrders;break;case"processing":t=allOrders.filter((e=>"Pending"===e.status));break;case"packed":t=allOrders.filter((e=>"Packed"===e.status||"Shipped"===e.status));break;case"delivered":t=allOrders.filter((e=>"Delivered"===e.status));break;case"cancelled":t=allOrders.filter((e=>"Cancelled"===e.status))}renderTable(t),document.querySelectorAll(".filter-btn").forEach((t=>{t.classList.toggle("active",t.dataset.filter===e)})),document.getElementById("load-more-btn").style.display="all"===e&&allOrders.length>3?"block":"none"}function checkPackedOrders(e){e.some((e=>"Packed"===e.status||"Shipped"===e.status))&&showPackedNotification()}function showPackedNotification(){const e=document.getElementById("packed-notification"),t=new bootstrap.Toast(e);t.show(),setTimeout((()=>{t.hide()}),5e3)}function renderTable(e){const t=document.getElementById("order-table-body");if(t.innerHTML="",0===e.length)return document.getElementById("no-orders").style.display="block",void(document.getElementById("order-summary").style.display="none");document.getElementById("no-orders").style.display="none",document.getElementById("order-summary").style.display="block",e.forEach(((e,n)=>{const s=document.createElement("tr");s.classList.add("fade-in"),s.style.animationDelay=50*n+"ms";const a="Shipped"===e.status?"Packed":e.status;let r=e.payment_status;"Delivered"===a?r="Paid":"Not Paid"===r&&(r="Cash on Delivery");const l=e.items.split(",").map((e=>{const[t,n]=e.trim().split(" x ");return{name:t,quantity:parseInt(n)||1}}));let d="";d="Cancelled"===a?"Order cancelled":"Packed"===a?"Ready for collection":"Delivered"===a?"Successfully delivered":"Processing"===a?"Preparing your order":"On its way to you";const o=new Date(e.order_time).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});s.innerHTML=`\n        <td class="order-id">${e.order_id}</td>\n        <td><a href="#" class="view-link" data-index="${allOrders.indexOf(e)}">${l.length} item(s)</a></td>\n        <td class="order-total">₹${e.total.toFixed(2)}</td>\n        <td>\n          <span class="status-badge ${a.toLowerCase()}">${a}</span>\n          <div class="status-info">${d}</div>\n        </td>\n        <td>\n          <span class="payment-badge ${r.toLowerCase().replace(" ","-")}">${r}</span>\n        </td>\n        <td>\n          <span class="text-muted small">${o}</span>\n        </td>\n        <td>\n          <button class="btn btn-sm btn-outline-primary view-details-btn" data-index="${allOrders.indexOf(e)}">\n            <i class="fas fa-eye me-1"></i> View\n          </button>\n        </td>\n      `,t.appendChild(s)})),document.querySelectorAll(".view-link, .view-details-btn").forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation();const t=parseInt(this.dataset.index);showModal(allOrders[t])}))})),document.querySelectorAll("tbody tr").forEach((e=>{e.addEventListener("click",(function(){const e=parseInt(this.querySelector(".view-link").dataset.index);showModal(allOrders[e])}))}))}function showModal(e){const t="Shipped"===e.status?"Packed":e.status;let n=e.payment_status;"Delivered"===t?n="Paid":"Not Paid"===n&&(n="Cash on Delivery");const s="Not Paid"===n?"Payment Pending":"Cash on Delivery",a=e.items.split(",").map((e=>{const[t,n]=e.trim().split(" x ");return{name:t,quantity:parseInt(n)||1}})),r=a.map((e=>`\n      <div class="order-detail-item">\n        <div class="d-flex justify-content-between align-items-center">\n          <span>${e.name}</span>\n          <span class="text-muted small">Qty: ${e.quantity}</span>\n        </div>\n      </div>\n    `)).join("");let l="",d="fa-info-circle",o="alert-info";"Cancelled"===t?(l="Your order has been cancelled. If this was unexpected, please contact our customer support team for assistance.",d="fa-exclamation-circle",o="alert-danger"):"Packed"===t?l="Your order has been packed and is ready for collection at EasanMart. Please collect it.":"Delivered"===t?(l="Your order has been successfully delivered. Thank you for shopping with us! We hope you enjoy your purchase.",d="fa-check-circle",o="alert-success"):l="Processing"===t?"We are currently processing your order. You will receive updates on Email as it progresses through our fulfillment system.":"Your order is being prepared for delivery. You will receive updates as it progresses through our fulfillment process.";const i=new Date(e.order_time).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),c=new Date(e.delivery_time).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0});document.getElementById("modal-content").innerHTML=`\n      <div class="order-details-header">\n        <div>\n          <h6 class="text-muted mb-1">Order #${e.order_id}</h6>\n          <small class="text-muted">Placed on ${i}</small>\n        </div>\n        <div class="order-status-container">\n          <span class="status-badge ${t.toLowerCase()} mb-2 d-inline-block">${t}</span>\n          <div class="order-total" style="font-size: 1.25rem;">₹${e.total.toFixed(2)}</div>\n        </div>\n      </div>\n      \n      <div class="mb-4">\n        <h6 class="text-muted mb-3">Ordered Items (${a.length})</h6>\n        ${r}\n      </div>\n      \n      <div class="payment-section mb-4">\n        <h6 class="text-muted mb-3">Payment Information</h6>\n        <div class="row">\n          <div class="col-md-6 mb-3">\n            <div class="bg-light p-3 rounded">\n              <p class="mb-2"><strong>Payment Method:</strong> ${s}</p>\n              <p class="mb-0"><strong>Payment Status:</strong> \n                <span class="payment-badge ${n.toLowerCase().replace(" ","-")} ms-2">\n                  ${n}\n                </span>\n              </p>\n            </div>\n          </div>\n          <div class="col-md-6 mb-3">\n            <div class="bg-light p-3 rounded">\n              <p class="mb-2"><strong>Order Date:</strong> ${i}</p>\n              <p class="mb-0"><strong>Estimated Delivery:</strong> ${c}</p>\n            </div>\n          </div>\n        </div>\n        ${"Not Paid"===n?'\n          <div class="alert alert-warning mt-2 mb-0">\n            <i class="fas fa-exclamation-triangle me-2"></i>\n            This order is not yet paid. Please prepare cash for delivery.\n          </div>\n        ':""}\n      </div>\n      \n      <div class="alert ${o}">\n        <i class="fas ${d} me-2"></i>\n        ${l}\n      </div>\n      \n      <div class="customer-support-section">\n        <h6 class="mb-3">Need Help With This Order?</h6>\n       <div class="order-actions d-flex gap-2">\n    \x3c!-- Chat With Us Button --\x3e\n    <a href="https://wa.me/919095502548?text=Order%20ID:%20${e.order_id}%0AStatus:%20${t}%0ATotal:%20₹${e.total.toFixed(2)}%0A%0APlease%20assist%20me%20with%20this%20order." \n       class="btn btn-success btn-sm d-flex align-items-center gap-2 px-3 py-2 text-decoration-none text-white" \n       target="_blank"\n       style="font-size: 0.875rem; border-radius: 5px;">\n      <i class="fab fa-whatsapp" style="font-size: 1rem;"></i>\n      <span>Chat With Us</span>\n    </a>\n    \x3c!-- Call Us Button --\x3e\n    <a href="tel:+919095502548" \n       class="btn btn-primary btn-sm d-flex align-items-center gap-2 px-3 py-2 text-decoration-none text-white"\n       style="font-size: 0.875rem; border-radius: 5px;">\n      <i class="fas fa-phone-alt" style="font-size: 1rem;"></i>\n      <span>Call Us</span>\n    </a>\n  </div>\n      </div>\n      \n      ${"Packed"===t?'\n        <div class="order-note mt-3">\n          <strong><i class="fas fa-info-circle me-2"></i>Collection Note:</strong>\n          Please bring your order confirmation email and a valid ID when collecting your order.\n        </div>\n      ':""}\n    `,modalInstance||(modalInstance=new bootstrap.Modal(document.getElementById("orderModal"))),document.getElementById("orderModalLabel").textContent=`Order #${e.order_id} Details`,modalInstance.show()}document.addEventListener("hidden.bs.modal",(function(){const e=document.getElementsByClassName("modal-backdrop");for(let t of e)t.parentNode.removeChild(t)})),fetchOrders(),document.getElementById("load-more-btn").addEventListener("click",fetchOrders),document.querySelectorAll(".filter-btn").forEach((e=>{e.addEventListener("click",(function(){applyFilter(this.dataset.filter)}))}))</script>
</body>
</html>
